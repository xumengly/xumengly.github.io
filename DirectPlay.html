<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>DirectPlay.html</title>
<style type="text/css">
<!--
	* {margin: 0px; padding: 0px; }
	body td { font-size: 16px; color: white; }
	img { filter: alpha( opacity = 75 ); }
	#no_order { position: absolute; height: 146px; width: 363px; top: 100px; left: 250px; display: none; }
	#chan_page { position: absolute; height: 20px; width: 40px; top: 398px; left: 168px; font-size: 17px; color: #FFFFFF; display: none; }
body,td,th {
	font-family: Arial, Helvetica, sans-serif;
}
-->
</style>
<script language="javascript" type="text/javascript" src="keyBorad.js"></script>
<script language="javascript" type="text/javascript">
var tempurllist = new Array();
var menu_urllist = new Array();
///////////////////////////////////////////////////////////////
var channelUrl = "Category.html?CHANNELTYPE=1";			//红 频道
var tvodUrl = "Category.html?CHANNELTYPE=2";									//绿 联通
var vodUrl = "Category.html?CHANNELTYPE=3";									//黄 境外
var nvodUrl = "Category.html?CHANNELTYPE=4";									//蓝 DM串流
var recUrl = "PlayRecord.html?playRecord=";									//播放录制文件
var saveUrl = "SaveCurrFocus.html";													//
var crlcheckUrl = "play_ControlPassCheckInfolock.html?&pwd="	//
//var favoriteUrl = 'IPTVFavourite.html';										//收藏
//var bookmarkUrl = 'IPTVFavourite.html';										//书签
//var helpUrl = 'IPTVFavourite.html';												//帮助
//var searchUrl = 'vod_searchFilm.html?isFirst=1';						//搜索

///////////////////////////////////////////////////////////////上面这几个暂时都没有用起来,一键切换也都还不行

var backUrl = "AuthenticationURL";													//返回
var lastChannelNo = 1; //Authentication.CTCGetConfig("LastChannelNo");     //上次播放的最后一个频道,现在有多个类别的频道,一切换就不好用了,所以设成频道1 
if (typeof(iPanel) != 'undefined')	iPanel.firstLinkFocus = 0;

///////////////////////////////////////////////////////////////频道列表相关变量定义 开始
var channelId = 2;				//频道ID
var currChannelNum = 0;		//当前频道号
var currChannelIndex = -1;//当前索引
var chanListFocus = -1;		//频道列表的当前索引
var totalChannel = -1;		//频道总个数
var infoFlag = "false";		//miniEPG标识位
var showTimer = -1;				//显示计时器
var hiddenTimer = -1;			//隐藏计时器
var rows = 10;						//行数
var cols = 1;							//列数
var page_items = rows * cols;	//总页数
var channelListFlag = "true";	//频道列表显示/隐藏标识
var channelListPlayFlag = "true";	//频道列表播放标识
var currListPage = 0;			//频道列表当前页
var totalListPages = 0;		//频道列表总页数
var channelListTimer = "";//频道列表计时器
var hideNumTimer = "";		//频道号清空计时器

var number = 0;						//数字切换频道
var numCount = 0;
var tempNumber = "";
var timeID = 0;						//数字键跳转计时器
var bottomLineNum = 0;		//频道号下划线
var bottomLineAllNum = 3;	//频道号总位数
var bottomLineHideTime = "";	//频道号下划线隐藏

var isControlChanIndex = -1;//当输入的频道号是受限制的频道号 记录当前索引
var lockPlay = "true";		//加锁播放标志
var lockTimer = "";				//加锁层隐藏计时器
var hiddenDiv = "";				//层隐藏计时器
var lockFlag = "false";		//锁控制标志位 false--解锁层不存在
var mediaErrorFlag = "false";//系统错误提示
var pr2 = null;						//提交频道控制信息
var live_type = "live";		//直播业务
var back_type = "back";		//直播回看业务
var business_type = live_type;//当前的业务类型 live_type直播状态 back_type时移状态
var shiftQuitFlag = 0;		//时移上报退出标志位
var isPerview = 1;				//是否支持预览
var isSubSingle = 1;			//是否订购
var isNotSubFlag = "false";			//未订购层标志位
var showFilmInfoFlag = "false";	//MINIEPG数据获取标志位
var isLeaveChannelFlag = "false";//断流标志位 如果==false 说明正常播放，未授权提示得自动消失 ,== true 说明没流未授权等提示要一直存在
var getDataFlag = "false";			//子页面获取数据标志位

var channelIds = new Array();		//频道id号
var channelNames = new Array();	//频道名称
var channelNums = new Array();	//频道号
var channelNumsShow = new Array();	//用来显示的频道号数组

var isSub = new Array();				//是否订购
var pltvStatus = new Array();		//是否是时移频道
var channelUrls = new Array();	//授权通过的URL链
var isLock = new Array();				//是否加锁
var isControlled = new Array();	//是否有父母控制
var channelCode = new Array();	//频道的MediaCode
var isSubPreview = new Array();	//是否支持预览
///////////////////////////////////////////////////////////////频道列表相关变量定义 结束

</script>
</head>

<script language="javascript" type="text/javascript">
///////////////////////////////////////////////////////////////遥控按键定义 开始
document.onirkeypress = keyEvent;
document.onkeypress = keyEvent;

function keyEvent()
{
	var val = event.which ? event.which : event.keyCode;
	return keypress(val);
}

function keypress(keyval)
{
switch (keyval)
{
case KEY_0:			//0键
	inputNum(0);
	break;
case KEY_1:			//1键
	inputNum(1);
	break;
case KEY_2:			//2键
	inputNum(2);
	break;
case KEY_3:			//3键
	inputNum(3);
	break;
case KEY_4:			//4键
	inputNum(4);
	break;
case KEY_5:			//5键
	inputNum(5);
	break;
case KEY_6:			//6键
	inputNum(6);
	break;
case KEY_7:			//7键
	inputNum(7);
	break;
case KEY_8:			//8键
	inputNum(8);
	break;
case KEY_9:			//9键
	inputNum(9);
	break;
case KEY_RETURN:	//回退键和返回键同样处理
	returnBack();
	break;
case KEY_OK:			//确认
	pressOK();
	break;
case KEY_SBL:			//按键-/--频道号下划线
	showBottomLine();
	break;
case KEY_ADD:			//加频道
	addChannel(); 
	break;
case KEY_DEC: 		//减频道
	decChannel();
	break;
case KEY_LEFT:		//控制节目单左翻页
	pressLeft();
	break;
case KEY_UP:			//
	arrowUp();
	break;
case KEY_RIGHT:		//控制节目单右翻页
	pressRight();
	break;
case KEY_DOWN:		//
	arrowDown();
	break;
case KEY_PAGE_UP:		//上页
	pageUp();
	break;
case KEY_PAGE_DOWN:	//下页
	pageDown();
	break;
case KEY_GO_BEGIN:	//
	break;
case KEY_INFO:			//
	infoKey();
	break;
case KEY_STOP:			//停止
	returnBack();
	break;
case KEY_RED:				//文广红键 直播	//广东ITV
case KEY_MENU_TV:		//频道
	pressKey_oneKeySwitchs("channel");
	break;
case KEY_GREEN:			//文广绿键 回看 //串流
case KEY_MENU_TVOD:	//回看
	pressKey_oneKeySwitchs("tvod");
	break;
case KEY_YELLOW:		//文广黄键 点播	//联通ITV
case KEY_MENU_VOD:	//点播
	pressKey_oneKeySwitchs("vod");
	break;
case KEY_BLUE:			//文广蓝键 			//本地播放
case KEY_MENU_INFO:	//
	pressKey_oneKeySwitchs("nvod");
	break;
case KEY_FAVORITE:	//收藏
	return;
case KEY_BOOKMARK:	//书签
	return;
case KEY_HELP:			//帮助
	return;
case KEY_SEARCH:		//搜索
	return;
case 0x300:		//虚拟按键定义，EPG页面的js逻辑通过onkeypress函数进行响应。虚拟事件通过Utility对象的getEvent函数获取
	goUtility();
	break;
case 39170:		//0x9904 预览次数
	previewTimes();
	break;
case 39171:		//0x9905 预览时间
	previewTime();
	break;
case 39172:		//0x9906 
	stbNoThisChannel(currChannelNum);
	break;
default:
  break;
}
//checkStatus(keyval);//检查频道列表操作状态
return true;
}
///////////////////////////////////////////////////////////////遥控按键定义 结束


///////////////////////////////////////////////////////////////遥控按键操作 开始

function stopChannel()	//离开当前频道
{
    clearTimeout(hiddenTimer);    //离开频道时清空miniEPG
    hiddenFilmInfo();
    if ("true" == isNotSubFlag)    //清空层
    {
        clearDiv();
    }
    if ("true" == lockFlag)    //清空锁控制层
    {
        hiddenLockInfo();
    }
    if ("false" == channelListFlag)    //清空频道列表
    {
        hiddenChannelList()
    }
  //if (preDivIsShow)    //清空预览提示
  //{
  //    hiddenPreview();
  //}
    if ("true" == mediaErrorFlag)    //清空错误层
    {
        hiddenMediaError();
    }
    hideChannelNum();    //清空频道号
    freeFocus(currChannelIndex);
}

function goBack()				//离开当前页面
{
	if ("true" == isNotSubFlag)  clearDiv();    //清空层
	if ("true" == lockFlag)  hiddenLockInfo();
	mp.leaveChannel();
	mp.stop();
	shiftQuitFlag = 1;    //此出赋值,以防在destoryMP方法中再上报一次
	if (isSubPreview[currChanIndex] == 1 && isSub[currChanIndex] == 3)    //如果是预览，不上报
	{
		window.location.href = backUrl;
		return;
	}
	setEPG();
	window.location.href = backUrl;
}

function returnBack()		//返回键
{
	if ("false" == channelListFlag)    //如果频道列表存在，先去掉频道列表
	{
		clearTimeout(channelListTimer);
		hiddenChannelList();
		return;
	}
	if (oneKeySwitchJumpInfoIsShow)    //如果一键跳转层显示，就先退出层
	{
		hideOneKeySwitchJumpInfo();
		return;
	}
	if (business_type == back_type)    //如果是时移状态的话，先切换到直播状态
	{
		mp.gotoEnd();
		return;
	}
	stopChannel();
	goBack();
}

function goUtility()		//0x300虚拟按键事件响应
{
	if (disLockFlag == 1)  return;
	eval("eventJson = " + Utility.getEvent());
	var typeStr = eventJson.type;
	switch (typeStr)
	{
	case "EVENT_MEDIA_ERROR":
		mediaError(eventJson);
		break;
	case "EVENT_PLAYMODE_CHANGE":
		resumeMediaError(eventJson);
		break;
	case "EVENT_PLTVMODE_CHANGE":
		playModeChange(eventJson);	//播放模式变化
		break;
	default:
		top.TVMS.dealKeyEvent(eventJson);
		break;
	}
	return true;
}

function playModeChange(eventJson)//播放模式变化
{
	hideMediaError();
	if (isSubPreview[currChannelIndex] == 1 && 3 == isSub[currChannelIndex])	return;    //如果是预览，不上报
	var stat = eventJson.service_type;
	if (stat == 1)//进入时移
	{
		if (business_type == live_type)	business_type = back_type;
	}
	if (stat == 0)//返回直播
	{
		if (business_type == back_type)	business_type = live_type;
	}
}

///////////////////////////////////////////////////////////////遥控按键操作 结束


///////////////////////////////////////////////////////////////一键切换 开始
var oneKeySwitchJumpUrl = ''; //一键切换跳转url
var isFocusLeft = "";
var oneKeySwitchJumpInfoIsShow = false;

function createOneKeySwitch(jumpFlag)//生成一键切换层
{
var divHtml = '<font color="white">您确定要跳转到';
switch(jumpFlag)
{
case 'channel':
	divHtml += '电信ITV';
	oneKeySwitchJumpUrl = channelUrl;
	break;
case 'tvod':
	divHtml += '联通ITV';
	oneKeySwitchJumpUrl = tvodUrl;
	break;
case 'vod':
	divHtml += 'SOP串流';
	oneKeySwitchJumpUrl = vodUrl;
	break;
case 'nvod':
	divHtml += 'DM串流';
	oneKeySwitchJumpUrl = nvodUrl;
	break;
case 'help':
	divHtml += '帮助';
	oneKeySwitchJumpUrl = helpUrl;
	break;
case 'favorite':
	divHtml += '收藏';
	oneKeySwitchJumpUrl = favoriteUrl;
	break;
case 'search':
	divHtml += '搜索';
	oneKeySwitchJumpUrl = searchUrl;
	break;
default:
	break;
}
var jumpInfo = document.getElementById("jumpInfo");
divHtml  += '页面?</font>';
jumpInfo.innerHTML = divHtml;
}

function showOneKeySwitchJumpInfo()
{
if("false" == channelListFlag)//1、一键跳转层显示的话，频道列表消失 //清空频道列表
{
hiddenChannelList();
}
if("true" == infoFlag)//如果miniepg显示，先清空
{
clearTimeout(hiddenTimer);
hiddenFilmInfo();
}
document.getElementById("none").focus();
isFocusLeft = "true";
document.getElementById("atRightFocus").src = "images/channellist/cancel.gif";
document.getElementById("atLeftFocus").src = "images/channellist/sure-2.gif";
setEPG();//2设置epg控制
if(oneKeySwitchJumpInfoIsShow)
{
return true;
}
var oneKeySwitchBack = document.getElementById("oneKeySwitchBack");
var oneKeySwitchJumpInfo = document.getElementById("oneKeySwitchJumpInfo");
oneKeySwitchBack.style.display = "block";
oneKeySwitchJumpInfo.style.display = "block";
oneKeySwitchJumpInfoIsShow = true;
}

function hideOneKeySwitchJumpInfo()
{
if(!oneKeySwitchJumpInfoIsShow)
{
return true;
}
setSTB();
var oneKeySwitchBack = document.getElementById("oneKeySwitchBack");
var oneKeySwitchJumpInfo = document.getElementById("oneKeySwitchJumpInfo");
oneKeySwitchBack.style.display = "none";
oneKeySwitchJumpInfo.style.display = "none";
oneKeySwitchJumpInfoIsShow = false;
document.getElementById("pwd").focus();
}

function pressRight()//右键控制，一键跳转层
{
	if ("true" == isFocusLeft)
	{
		document.getElementById("atLeftFocus").src = "images/channellist/sure.gif";
		document.getElementById("atRightFocus").src = "images/channellist/cancel-2.gif";
		isFocusLeft = "false";
	}
}

function pressLeft()//左键控制，一键跳转层
{
	if ("false" == isFocusLeft)
	{
		document.getElementById("atRightFocus").src = "images/channellist/cancel.gif";
		document.getElementById("atLeftFocus").src = "images/channellist/sure-2.gif";
		isFocusLeft = "true";
	}
}

function pressKey_oneKeySwitchs(jumpFlag)//按下一键切换键
{
	createOneKeySwitch(jumpFlag);
	showOneKeySwitchJumpInfo();
}

///////////////////////////////////////////////////////////////一键切换 结束


///////////////////////////////////////////////////////////////重要操作 开始
function shwoFilmInfo()		//MINIEPG显示
{
    if (0 == bottomLineNum)    //频道下划线存在的时候不显示
    {
        showChannelNum();        //频道号显示
    }
    document.getElementById("filmInfo1").style.display = "block";
    infoFlag = "true";
    hiddenTimer = setTimeout("hiddenFilmInfo()", 6000);
}

function hiddenFilmInfo()	//MINIEPG隐藏
{
    if ("true" == infoFlag)    //隐藏频道号
    {
        clearTimeout(hideNumTimer);
        hideChannelNum();
    }
    clearTimeout(hideNumTimer);
    hideNumTimer = setTimeout("hideChannelNum()", 6000);

    top.EPG.miniInfo.clear_info();
    top.EPG.miniInfo.location.href = "";
    document.getElementById("filmInfo1").style.display = "none";

    infoFlag = "false";
}

function showInfo()				//miniEPG数据
{
	if(currChannelIndex == -1) 
	{    // 有可能是一键切换的频道，currChannelIndex == -1，channelId为空
		top.EPG.miniInfo.location.href = "MiniInfo.html?CHANNELID=" + channelId + "&PLTVStatusFlag=" + isSubPreview[currChannelIndex];
	} 
	else
	{
		miniInfo.location.href = "MiniInfo.html?CHANNELID=" + channelIds[currChannelIndex] + "&PLTVStatusFlag=" + isSubPreview[currChannelIndex];
		//top.EPG.miniInfo.location.href = "MiniInfo.html?CHANNELID=" + channelIds[currChannelIndex] + "&PLTVStatusFlag=" + isSubPreview[currChannelIndex];
	}
}

function infoKey()				//信息健
{
	if ("false" == infoFlag)
	{
		clearTimeout(showTimer);
		clearTimeout(hiddenTimer);
		if ("true" == getDataFlag)
		{
			showInfo();
			shwoFilmInfo();
		}
	}
	else
	{
		clearTimeout(hiddenTimer);
		hiddenFilmInfo();
	}
}
///////////////////////////////////////////////////////////////
var mp = new MediaPlayer(1);//创建MediaPlayer对象

function setSTB()		//按键机顶盒控制
{
	Authentication.CTCSetConfig("key_ctrl_ex", "1");
}

function setEPG()		//按键EPG控制
{
	Authentication.CTCSetConfig("key_ctrl_ex", "0");
}

function initMediaPlay()//播放初始化函数
{
	var instanceId = mp.getNativePlayerInstanceID();
	var playListFlag = 0;
	var videoDisplayMode = 1;
	var height = 0;
	var width = 0;
	var left = 0;
	var top = 0;
	var muteFlag = 0;
	var subtitleFlag = 0;
	var videoAlpha = 0;
	var cycleFlag = 0;
	var randomFlag = 0;
	var autoDelFlag = 0;
	var useNativeUIFlag = 1;
	mp.initMediaPlayer(instanceId, playListFlag, videoDisplayMode, height, width, left, top, muteFlag, useNativeUIFlag, subtitleFlag, videoAlpha, cycleFlag, randomFlag, autoDelFlag);
}

function joinChannel(chanNum)//切换频道
{
	if ("true" == infoFlag)    //如果miniEPG显示，先清空
	{
		clearTimeout(hiddenTimer);
		hiddenFilmInfo();
	}
	showChannelNum();
//	if (0 == isSubSingle && 1 == isPerview)    //1,外部进来 预览播放
//	{
//		var testChanNum = "<ChannelPreviewCMD ChannelNo='" + chanNum + "'/>";
//		mp.sendVendorSpecificCommand(testChanNum);
//		isSubSingle = -1;
//		isPerview = -1;
//	}
//	else if (isSubPreview[currChannelIndex] == 1 && 3 == isSub[currChannelIndex])    //2,内部切换 预览播放
//	{
//		var testChanNum = "<ChannelPreviewCMD ChannelNo='" + chanNum + "'/>";
//		mp.sendVendorSpecificCommand(testChanNum);
//	}
//	else    //3,开机播放,正常播放
//	{
		mp.joinChannel(chanNum);
//	}
	isLeaveChannelFlag = "false";    //恢复流
	setFocus(currChannelIndex);
	if ("true" == showFilmInfoFlag)  //新频道播放前需要重新设置miniEPG显示
	{
		showInfo();
	}
	business_type = live_type;    // 准备本次信息的上报
}

function loadData()//从子页面加载数据
{	
	filmInfo.location.href = "ChannelList.html?CHANNELID=" + channelId + "&CHANNELNUM=" + currChannelNum;
  //top.EPG.filmInfo.location.href = "ChannelList.html?CHANNELID=" + channelId + "&CHANNELNUM=" + currChannelNum;
}

function init()		//页面初始化
{
	setSTB();
	initMediaPlay();
	mp.setAllowTrickmodeFlag(0);		//0不允许媒体快进，快退，暂停	1本地控制
	mp.setChannelNoUIFlag(0);				//0不使频道号本地显示					1本地显示
	mp.setNativeUIFlag(1);					//0不使UI本地显示							1本地显示
	mp.setMuteUIFlag(1);						//0静音图标不显示							1本地显示
	mp.setAudioVolumeUIFlag(1);			//设置音量调节本地UI的显示标志 0:不允许 1：允许
	mp.setAudioTrackUIFlag(1);			//设置音轨本地UI的显示标志		1: 允许
	mp.setVideoDisplayArea(0, 0, 0, 0);    //全屏显示
	mp.setVideoDisplayMode(1);
	mp.refreshVideoDisplay();			//调整视频显示，需要上面两函数配合
	joinChannel(currChannelNum);
	loadData();
}

function destoryMP()	//页面退出的时候无条件执行
{
	if (1 == shiftQuitFlag)    //如果是按的返回健退出的话，此处就不上报
	{
		stopChannel();
		return;
	}
	if (isSubPreview[currChannelIndex] == 1 && isSub[currChannelIndex] == 3)    //如果是预览，不上报
	{
		stopChannel();
		return;
	}
	setEPG();
	mp.leaveChannel();
	stopChannel();
}

///////////////////////////////////////////////////////////////重要操作 结束


///////////////////////////////////////////////////////////////频道列表函数 开始

///////////////////////////////////////////////////////////////
function getInt(num)//获取正整数
{
	num = num + "";
	var i = num.indexOf(".");
	var currpage = num.substring(0, i);
	return parseInt(currpage, 10);
}

function realCurrPage()//根据索引判断当前是第几页
{
	if (chanListFocus % 10 == 0)  currListPage = chanListFocus / 10;
	else  currListPage = getInt(chanListFocus / 10);
}

function showPage()//页码显示
{
	document.getElementById("chang_pageShow").innerHTML = currListPage + 1 + "/" + totalListPages;
}

function create_data(div_name,rows,cols,td_width,td_height,image_position,img_width,img_height,coffset,cborder,curr_page,list_name,image_path)
{
	var channelListTab = '<table width="'+ td_width*cols +'" height="'+ td_height*rows +'" cellpadding="0" cellspacing="0" border="'+ cborder +'">';
	for(var i = 0; i < rows; i++)
	{
  	channelListTab += '<tr>';
  	for(var j = 0; j < cols; j++)
  	{
			var index = (i*cols + j) + (curr_page*(rows*cols));
			if(image_position == 'left')
			{
				if(list_name[index] != null)
				{
					channelListTab += '<td width="'+ td_width +'" height="'+ td_height +'" align="left"><img src="'+ image_path +'" width="'+ img_width +'" height="'+ img_height +'"/>&nbsp;' + list_name[index];
					channelListTab += '</td>';
				}
				else
				{
					channelListTab += '<td width="'+ td_width +'" height="'+ td_height +'">';
					channelListTab += '</td>';
				}
			}
			else if(image_position == 'right')
			{
				if(list_name[index] != null)
				{
					channelListTab += '<td width="'+ (td_width - img_width - coffset) +'" height="'+ td_height +'" align="left">' + list_name[index];
					channelListTab += '</td><td width="'+ (img_width + coffset) +'"><img src="'+ image_path +'" width="'+ img_width +'" height="'+ img_height +'" /></td>';
				}
				else
				{
					channelListTab += '<td width="'+ td_width +'" height="'+ td_height +'" colspan="2" align="center">';
					channelListTab += '</td>';
				}
			}
			else if(image_position == 'none')
			{
				if(list_name[index] != null)
				{
					channelListTab += '<td width="'+ td_width +'" height="'+ td_height +'">' + list_name[index];
					channelListTab += '</td>';
				}
				else
				{
					channelListTab += '<td width="'+ td_width +'" height="'+ td_height +'">';
					channelListTab += '</td>';
				}
			}
  	}
		channelListTab += '</tr>';
	}
	channelListTab += '</table>';
	document.getElementById(div_name).innerHTML = channelListTab;
}

function init_data()//加载频道列表
{
	create_data('chan_name', rows, cols, 180, 33, 'none', 'none', 'none', 'none', 0, currListPage, channelNames, 'none');
	create_data('chan_num', rows, cols, 40, 33, 'none', 'none', 'none', 'none', 0, currListPage, channelNumsShow, 'none');
}

function chanReload1()//重载频道列表
{
	init_data();
	showPage();
}

function showChannelListDiv()//频道列表层显示
{
	channelListFlag = "false";
	bg_chan.style.display = "block";
	chan_table.style.display = "block";
	chan_num.style.display = "block";
	chan_name.style.display = "block";
	chan_page.style.display = "block";
}

function showChannelList()//显示频道列表
{
	setEPG();
	freeFocus(chanListFocus);
	chanListFocus = currChannelIndex;
	realCurrPage();    //当前是第几页
	chanReload1();
	setFocus(chanListFocus);
	showChannelListDiv();
	clearTimeout(channelListTimer);    //频道列表在8秒后未被操作自动消失
	channelListTimer = setTimeout("hiddenChannelList();", 6000);
}

function hiddenChannelList()//隐藏频道列表
{
	if (!oneKeySwitchJumpInfoIsShow)	setSTB();
	channelListFlag = "true";
	bg_chan.style.display = "none";
	chan_table.style.display = "none";
	chan_num.style.display = "none";
	chan_name.style.display = "none";
	chan_page.style.display = "none";
}

function playByChannelList()//通过频道列表播放
{
	lockPlay = "true";
	if ("true" == isNotSubFlag)  clearDiv();	//清空层
	if ("true" == mediaErrorFlag)  hiddenMediaError();	//清空错误层
  //if (preDivIsShow)  hiddenPreview();	//清空预览提示
	authtication(chanListFocus);
	if ("false" == lockPlay) return;
  isHaveLock();    										//如果锁存在，则频道列表一直存在
	currChannelIndex = chanListFocus;		//播放时需要把频道列表的临时焦点赋给真正的焦点
	joinChannel(channelNums[chanListFocus]);
}

///////////////////////////////////////////////////////////////

function pageDown()	//下翻页
{
	if ("true" == channelListFlag)  return;   //频道列表不显示，按翻页键没用
	if (currListPage > totalListPages - 1 || totalListPages == 1)  return;
	freeFocus(chanListFocus);
	if (currListPage == totalListPages - 1)  currListPage = 0;    //如果是最后一页 则下翻到第一页
	else  currListPage++;
	chanReload1();
	chanListFocus = currListPage * 10;
	setFocus(chanListFocus);
  isHaveLock();    //如果锁存在，则频道列表一直存在
}

function pageUp()		//上翻页
{
	if ("true" == channelListFlag)  return;   //频道列表不显示，按翻页键没用
	if (currListPage < 0 || totalListPages == 1) 	return;
	freeFocus(chanListFocus);
	if (currListPage == 0)  currListPage = totalListPages - 1;   //如果是第一页 则上翻到最后一页
	else  currListPage--;
	chanReload1();
	chanListFocus = currListPage * 10;
	setFocus(chanListFocus);
  isHaveLock();    //如果锁存在，则频道列表一直存在
}

function addChannel()		//向上切频道 函数中注意先后顺序
{
	if (oneKeySwitchJumpInfoIsShow)  return;		//如果一键跳转层显示，不能切频道
	stopChannel();															//先离开上一个频道
	if (totalChannel == currChannelIndex)  currChannelIndex = 0;    //是否频道是最后一个频道，如果是应该切到第一个频道
	else  currChannelIndex++;
	lockPlay = "true";
	authtication(currChannelIndex);
	if ("false" == lockPlay)  return;
	if (channelNums[currChannelIndex])	currChannelNum = channelNums[currChannelIndex];		//更新当前频道号
	joinChannel(channelNums[currChannelIndex]);
}

function decChannel()		//向下切频道 函数中注意先后顺序
{
	if (oneKeySwitchJumpInfoIsShow)  return;		//如果一键跳转层显示，不能切频道
	stopChannel();    													//先离开上一个频道
	if (0 == currChannelIndex)   currChannelIndex = totalChannel;   //是否频道是第一个频道，如果是应该切到最后一个频道
	else  currChannelIndex--;
	lockPlay = "true";
	authtication(currChannelIndex);
	if ("false" == lockPlay)  return;
	if (channelNums[currChannelIndex])  currChannelNum = channelNums[currChannelIndex];		//更新当前频道号
	joinChannel(channelNums[currChannelIndex]);
}

function setFocus(curr_focus)//获得焦点选择
{
	var focusAt = curr_focus % 10;
	if (document.getElementById("img" + focusAt) == 'undefined')  return;
	document.getElementById("img" + focusAt).src = "images/channellist/chan_check.gif";
}

function freeFocus(curr_focus)//释放焦点选择
{
	var focusAt = curr_focus % 10;
	if (document.getElementById("img" + focusAt) == 'undefined' || curr_focus == -1)  return;
	document.getElementById("img" + focusAt).src = "images/channellist/chan_nocheck.gif";
}

function addChannelList()//频道列表下键切频道 函数中注意先后顺序
{
	freeFocus(chanListFocus);
	if (totalChannel == chanListFocus)	chanListFocus = 0;    //是否频道是最后一个频道，如果是应该切到第一个频道
	else	chanListFocus++;
	setFocus(chanListFocus);
  isHaveLock();    //如果锁存在，则频道列表一直存在
	if ("true" == lockFlag)	 hiddenLockInfo();
}

function decChannelList()//频道列表上键切频道  函数中注意先后顺序
{
	freeFocus(chanListFocus);
	if (0 == chanListFocus)	 chanListFocus = totalChannel;    //是否频道是后一个频道，如果是应该切到第一个频道
	else 	chanListFocus--;
	setFocus(chanListFocus);
  isHaveLock();    //如果锁存在，则频道列表一直存在
	if ("true" == lockFlag)	 hiddenLockInfo();
}

function arrowDown()//向下键
{
	if ("false" == channelListFlag)    //频道列表显示的时候，处理按键
	{
		if (chanListFocus % 10 == 9 || chanListFocus == totalChannel)
		{
			pageDown();
			return;
		}
		addChannelList();
		return;
	}
	decChannel();
}

function arrowUp()//向上键
{
	if ("false" == channelListFlag)    //频道列表显示的时候，处理按键
	{
		if (chanListFocus % 10 == 0)
		{
			pageUp();
			return;
		}
		decChannelList();
		return;
	}
	addChannel();
}

function jumpOut()
{
	stopChannel();
	mp.leaveChannel();
	mp.stop();
	if(oneKeySwitchJumpInfoIsShow)	hideOneKeySwitchJumpInfo();
	setEPG();
	shiftQuitFlag = 1;//此出赋值,以防在destoryMP方法中再上报一次

	if(isSubPreview[currChannelIndex] == 1 && isSub[currChannelIndex] == 3)//如果是预览，不上报
	{
		stopChannel();
		window.location.href = oneKeySwitchJumpUrl;
		return;
	}
	if(null != pr2)//时移状态下跳转
	{
		if(business_type == back_type)	pr2.servletSubmit("2","removeOnPlayUser",pr2.progId);
		else	pr2.servletSubmit("1","removeOnPlayUser",pr2.progId);
	}
	window.location.href = oneKeySwitchJumpUrl;
}

function pressOK()	//OK键
{
	if ("false" == channelListFlag)		//如果显示就隐藏
	{
		if (currChannelIndex == chanListFocus && isLeaveChannelFlag == "false")   hiddenChannelList();	//如果是当前播放的频道，并且不是在停流的情况下
		else  playByChannelList();			//频道列表上按ok键切换频道
	}
	else
	{
		if ("true" == lockFlag || oneKeySwitchJumpInfoIsShow)		//如果解锁层显示、一键跳转层显示，则不调出频道列表
		{
			if ("true" == isFocusLeft)  jumpOut();								//跳转
			else  hideOneKeySwitchJumpInfo();
			return;
		}
		if ("true" == getDataFlag)	showChannelList();
	}
}

///////////////////////////////////////////////////////////////

function channelNumAction(chanNum)//频道号显示
{
	if (mp.getNativeUIFlag() == 1 && mp.getChannelNoUIFlag() == 1)  return;   // 如果机顶盒来控制,则不显示	
	var channelNumDef = '<table width=200 height=30><tr align="right"><td><font color=green size=20>';
	channelNumDef += chanNum;
	channelNumDef += '</font></td></tr></table>';
	document.getElementById("topframe").innerHTML = channelNumDef;
	clearTimeout(hideNumTimer);    // 八秒钟后隐藏频道号
	hideNumTimer = setTimeout("hideChannelNum()", 6000);
}

function inputNum(chanNum)//输入数字切换频道
{
	if (oneKeySwitchJumpInfoIsShow)  return;    //如果一键跳转层显示，不能切频道
	if ("false" == channelListFlag)  return;    //如果有频道列表存在，不能切频道
	if (number * 10 >= 1000)  return;    //如果频道号大于1000
	if (bottomLineNum != 0)    //不能大过下划线
	{
		clearTimeout(bottomLineHideTime);
		bottomLineHideTime = setTimeout("hideBottomLine()", 6000);
		if (numCount >= bottomLineNum)  return;
	}
	if (numCount >= 3)  return;
	numCount++;
	tempNumber = tempNumber + "" + chanNum;
	number = number * 10 + chanNum;
	channelNumAction(tempNumber);
	clearTimeout(timeID);    // 一秒钟之后切换频道
	timeID = setTimeout("playByChannelNum(" + number + ")", 1000);
}

function playByChannelNum(chanNum)//用户输入的频道号时的处理
{
	if (bottomLineNum != 0)    //是否是通过下划线切换
	{
		clearTimeout(bottomLineHideTime);
		bottomLineHideTime = setTimeout("hideBottomLine()", 6000);
		clearTimeout(hideNumTimer);
		hideNumTimer = setTimeout("hideChannelNum()", 6000);
		if (numCount < bottomLineNum)  return;
	}
	clearTimeout(bottomLineHideTime);
	hideBottomLine();
	number = 0;    //输入的数字
	numCount = 0;
	tempNumber = "";
	updateChannelFromNum(chanNum);
}

function getChanIndexByNum(chanNum)//通过频道号比对出索引
{
	var chanIndex = -1;
	for (var i=0; i<=totalChannel; i++)
	{
		if (chanNum == channelNums[i])
		{
			chanIndex = i;
			break;
		}
	}
	return chanIndex;
}

function updateChannelFromNum(chanNum)		//数字播放
{
	if (chanNum == currChannelNum && isLeaveChannelFlag == "false")  return;		//判断当前输入的频道号是否是正在播放的频道
	stopChannel();																	//离开上一个频道
	var returnIndex = getChanIndexByNum(chanNum);		//通过用户输入的频道号判断频道是否存在，加锁，父母控制等等
	if (-1 == returnIndex)	channelIsNotExist(chanNum);		//频道不存在
	else if (3 == isSub[returnIndex] && 1 != isSubPreview[returnIndex])	 channelIsNotSub(chanNum);		//授权未通过,不支持预览
	else if ("true" == isControlled[returnIndex] || 1 == isLock[returnIndex])		//频道有父母级别控制/加锁
	{
		clearTimeout(showTimer);
		showLockInfo();
		isControlChanIndex = returnIndex;		//需要记录受控的频道索引，到解锁页面使用
		lockPlay = "false";
	}
	else
	{
		currChannelIndex = returnIndex;			//把频道号和所对应的索引赋给currChannelIndex 修改
		currChannelNum = chanNum;
		joinChannel(chanNum);
	}
}

function showChannelNum()//频道号显示
{
	if (channelNums[currChannelIndex] != undefined)    //基本以频道号为主
	{
		channelNumAction(channelNums[currChannelIndex]);
	}
	else	channelNumAction(currChannelNum);
}

function hideChannelNum()//隐藏频道号
{
	numCount = 0;
	number = 0;
	tempNumber = "";
	document.getElementById("topframe").innerHTML = "";
}

function showBottomLine()//显示频道号下划线
{
	if (oneKeySwitchJumpInfoIsShow)   return;   //如果一键跳转层显示，不能切频道
	if ("false" == channelListFlag)   return; 	//如果有频道列表存在，不能切频道

	if (hideNumTimer != "")	 clearTimeout(hideNumTimer);
	clearTimeout(hideNumTimer);
	hideChannelNum();
	if (bottomLineHideTime != "")  clearTimeout(bottomLineHideTime);
	if (bottomLineNum < bottomLineAllNum)  bottomLineNum++;
	else  bottomLineNum = 0;
	var strBottom = '<table width=200 height=30><tr align="right"><td><font color="green" size="20"  height="10" style="font-weight:900">';
	for (var i = 0; i < bottomLineNum; i++)
	{
		strBottom += '_';
	}
	strBottom += '</font></td></tr></table>';
	document.getElementById("topframe_bottomLine").innerHTML = strBottom;
	clearTimeout(bottomLineHideTime);
	bottomLineHideTime = setTimeout("hideBottomLine()", 6000);
}

function hideBottomLine()//隐藏频道号下划线
{
	bottomLineNum = 0;
	numCount = 0;
	document.getElementById("topframe_bottomLine").innerHTML = "";
}

///////////////////////////////////////////////////////////////
function create_datatable(div_name,rows,cols,td_width,td_height,image_path,img_width,img_height,cborder)
{
	var channelListTab = '<table width="'+ td_width*cols +'" height="'+ td_height*rows +'" cellpadding="0" cellspacing="0" border="'+ cborder +'">';
	for(var i = 0; i < rows; i++)
	{
		channelListTab += '<tr>';
		for(var j = 0; j < cols; j++)
  	{
   		channelListTab += '<td width="'+ td_width +'" height="'+ td_height +'" valign="middle">';
   		channelListTab += '<img id="img' + String(i*cols + j) + '" src="'+ image_path +'" width="'+ img_width +'" height="'+ img_height +'"/></td>';
		}
		channelListTab += '</tr>';
	}
	channelListTab += '</table>';
	document.getElementById(div_name).innerHTML = channelListTab;
}

function init_page()//频道列表页面初始化
{
	create_datatable('chan_table', rows, cols, 180, 33, 'images/channellist/chan_nocheck.gif', 180, 29, 0);
	init_data();
	setFocus(chanListFocus);
	showPage();
}

///////////////////////////////////////////////////////////////

function channelIsNotExist(chanNum)//频道不存在
{
	clearTimeout(hiddenDiv);
	hiddenDiv = setTimeout("clearDiv();", 6000);
	isNotSubFlag = "true";
	bg_noorder.style.display = "block";
	no_order.style.display = "block";
	document.getElementById("orderInfo").innerHTML = '频道&lt;' + chanNum + '&gt;不存在,';
	document.getElementById("showmessage").innerHTML = "请切换到其它频道收看!";
}

function channelIsNotSub(chanNum)//频道未订购
{
	clearTimeout(hiddenDiv);
	hiddenDiv = setTimeout("clearDiv();", 6000);
	isNotSubFlag = "true";
	bg_noorder.style.display = "block";
	no_order.style.display = "block";
	document.getElementById("orderInfo").innerHTML = '您尚未订购&lt;' + chanNum + '&gt;频道,';
	document.getElementById("showmessage").innerHTML = "请切换到其它频道收看!";
}

///////////////////////////////////////////////////////////////频道列表函数 结束

function formatDate(dateobj)
{
var year = dateobj.getYear();
var month = dateobj.getMonth() + 1;
var day = dateobj.getDate();
var hour = dateobj.getHours();
var min = dateobj.getMinutes();
var sec = dateobj.getSeconds();

if (month < 10)
month = "0" + month;
if (day < 10)
day = "0" + day;
if (hour < 10)
hour = "0" + hour;
if (min < 10)
min = "0" + min;
if (sec < 10)
sec = "0" + sec;
var dateStr = "" + year  + month  + day + hour  + min  + sec;
return dateStr;
}

function PlayRecordStat(type)
{
this.flag = 0;
this.beginTime = 0;
this.endTime = 0;
this.elapseTime = 0;
this.playType = type;
this.progId = 0;
this.pop = "";
this.timeShift = 0;
this.shiftState = 0;
this.shiftBeginTime = 0;
this.shiftEndTime = 0;
this.submit = function(nextUrl){
	if(this.progId == "-1" || "null" == this.progId)
		{
			window.location = nextUrl;
    }
	if (this.beginTime == 0)
		{
			return;
		}
	if (this.flag == 1)
		{
			return;
		}
	else
		{
			this.flag = 1;
		}
	this.endShift();
	this.endTime = new Date();
	this.elapseTime = Math.round((this.endTime - this.beginTime)/1000);
	this.beginTime = formatDate(this.beginTime);
	this.endTime = formatDate(this.endTime);
	var submitDef = "";
	submitDef += recUrl + this.beginTime + "|";
	submitDef += this.endTime + "|" + this.elapseTime + "|";
	submitDef += this.playType+ "|" + this.progId + "|";
	submitDef += this.pop + "|" + this.timeShift;
	if (nextUrl != undefined && nextUrl != "undefined")
		{
			submitDef += "&pageName=" + nextUrl;
		}
	window.location = submitDef;
};
this.localSubmit = function(){
	if(this.progId == "-1")
		{
			return;
    }
if (this.beginTime == 0)
{
return;
}

if (this.flag == 1)
{
return;
}
else
{
this.flag = 1;
}
this.endShift();
this.endTime = new Date();
this.elapseTime = Math.round((this.endTime - this.beginTime)/1000);

this.beginTime = formatDate(this.beginTime);
this.endTime = formatDate(this.endTime);
var submitDef = "";
submitDef += recUrl + this.beginTime + "|";
submitDef += this.endTime + "|" + this.elapseTime + "|";
submitDef += this.playType+ "|" + this.progId + "|";
submitDef += this.pop + "|" + this.timeShift;
document.getElementById("prFrame").src = submitDef;

};
this.servletSubmit = function(status,type,chan){
if(chan == "-1")
{
    return;
}

var submitDef = "";
submitDef += "/EPG/html/EPGServlet?action_type=PLAYRECORD&recordType="+type+"&progId="+chan+"&playType="+status;
document.getElementById("onPrFrame").src = submitDef;
};
this.servletSubmit2 = function(status,type,chan,nextChan){
if(chan == "-1" || nextChan == "-1")
{
    return;
}

var submitDef = "";
submitDef += "/EPG/html/EPGServlet?action_type=PLAYRECORD&recordType="+type+"&progId="+chan+"&playType="+status+"&nextChan="+nextChan;
document.getElementById("onPrFrame2").src = submitDef;
};
this.endShift = function(){
if (this.shiftState == 0)
{
return;
}

this.shiftState = 0;
this.shiftEndTime = new Date();
this.timeShift += Math.round((this.shiftEndTime - this.shiftBeginTime)/1000);
};
this.beginShift = function(){
if (this.shiftState == 1)
{
return;
}
else
{
this.shiftState = 1;
this.shiftBeginTime = new Date();
}
};
}

var IdStb = document.getElementById("IdStb");

///////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////授权及锁处理 开始
function isHaveLock()//判读是否有锁，如果有锁的话，频道列表得一直显示
{
    if ("true" == lockFlag)
    {
        clearTimeout(channelListTimer);
    }
    else
    {
        clearTimeout(channelListTimer);
        channelListTimer = setTimeout("hiddenChannelList();", 6000);
    }
}

function showLockInfo()//父母控制，加解锁提示
{
	clearTimeout(lockTimer);
	lockTimer = setTimeout("hiddenLockInfo();", 6000);
	lockFlag = "true";
	bg_lockpass.style.display = "block";
	lock_pass.style.display = "block";
	document.getElementById("pwd").focus();
}

function hiddenLockInfo()//隐藏解锁提示信息
{
	lockFlag = "false";
	document.getElementById("pwd").value = "";
	document.getElementById("passInfo").innerHTML = "";
	bg_lockpass.style.display = "none";
	lock_pass.style.display = "none";
}

function authtication(_chanIndex)//授权验证，父母控制，加锁等
{
	if (3 == isSub[_chanIndex] && 1 != isSubPreview[_chanIndex])    //授权未通过,不支持预览
	{
		showChannelNum();
		channelIsNotSub(channelNums[_chanIndex]);
		if ("false" == channelListFlag && isLeaveChannelFlag == "false")
		{
			clearTimeout(hiddenDiv);
			hiddenDiv = setTimeout("clearDiv();", 6000);
		}
			lockPlay = "false";
	}
	else if ("true" == isControlled[_chanIndex] || 1 == isLock[_chanIndex])    //频道有父母级别控制/加锁
	{
		lockFlag = "true";
		isControlChanIndex = _chanIndex;        //需要记录受控的频道索引，到解锁页面使用
		isHaveLock();        //如果锁存在，则频道列表一直存在
		showLockInfo();
		lockPlay = "false";
    }
}

///////////////////////////////////////////////////////////////
function clearDiv()//清空层 主要是未授权、频道不存在、
{
	isNotSubFlag = "false";    //未授权
	bg_noorder.style.display = "none";
	no_order.style.display = "none";
}

function isValidString(s)//判断输入字符是否为空
{
	var tmpString = s;
	if (tmpString.length == 0)
	{
		document.getElementById("passInfo").innerHTML = "密码不能为空!";
		document.getElementById("pwd").value = "";
		document.getElementById("pwd").focus();
		return false;
	}
	else  return true;
}

function clickAction(value)
{
	var pwd = document.getElementById("pwd").value;
	if (isValidString(pwd))
	{
		var tmpChanIndex = -1;
		if (isControlChanIndex != -1)  tmpChanIndex = isControlChanIndex;
		else  tmpChanIndex = currChannelIndex;
		var strUrl = crlcheckUrl + pwd;
		strUrl += "&currChanNum=" + channelNums[tmpChanIndex] + "&currChannelId=" + channelIds[tmpChanIndex] + "&currChanIndex=" + tmpChanIndex;
		top.EPG.golock.location.href = strUrl;
	}
}

///////////////////////////////////////////////////////////////授权及锁处理 结束


///////////////////////////////////////////////////////////////错误处理 开始
function showErrorInfo()//错误提示信息
{
	document.getElementById("passInfo").innerHTML = "密码错误!";
	document.getElementById("pwd").value = "";
	document.getElementById("pwd").focus();
}

function mediaError(eventJson)//错误提示函数
{
	var type = eventJson.error_code;
	if (101 == type)  showMediaError();
}

function showMediaError()		//显示错误信息
{
	if ("false" == channelListFlag)		//如果频道列表存在，先去掉频道列表
	{
		clearTimeout(channelListTimer);
		hiddenChannelList();
	}
	if (oneKeySwitchJumpInfoIsShow)  hideOneKeySwitchJumpInfo();	//如果一键跳转层显示，就先退出层
  if (preDivIsShow)	 hiddenPreview();					//清空预览提示
	if ("true" == isNotSubFlag)  clearDiv();    //清空层
	if ("true" == lockFlag)   hiddenLockInfo(); //清空锁控制层
	mediaErrorFlag = "true";
	document.getElementById("errorDiv").style.display = "block";
	document.getElementById("errorBackGround").style.display = "block";
}

function hiddenMediaError()	//隐藏错误提示信息
{
	mediaErrorFlag = "false";
	document.getElementById("errorDiv").style.display = "none";
	document.getElementById("errorBackGround").style.display = "none";
}

function stbNoThisChannel(chanNum)//频道列表存在，但是机顶盒中不存在
{
	clearTimeout(showTimer);
	isNotSubFlag = "true";
	bg_noorder.style.display = "block";
	no_order.style.display = "block";
	document.getElementById("orderInfo").innerHTML = '频道&lt;' + chanNum + '&gt;暂时不能播放,';
	document.getElementById("showmessage").innerHTML = "请重启机顶盒更新频道列表或切换到其他频道!";
}

function resumeMediaError(eventJson)//清除断流错误提示
{
	var type_new_play = eventJson.new_play_rate;
	var type_old_play = eventJson.old_play_rate;
	if (1 == type_new_play && 0 == type_old_play)
	{
		if ("true" == mediaErrorFlag)  hiddenMediaError();       //清空错误层
		mp.resume();        //继续播放
	}
	if (0 != type_new_play)    //如果是暂停状态
	{
		if (oneKeySwitchJumpInfoIsShow)   hideOneKeySwitchJumpInfo();        //一键跳转到其他频道
	}
}
///////////////////////////////////////////////////////////////错误处理 结束


///////////////////////////////////////////////////////////////预览处理 开始
var preDivIsShow = false;//预览层是否显示
function previewTimes()//预览次数
{
	if ("true" == isNotSubFlag)   clearDiv();					//清空层
	if ("true" == lockFlag)  hiddenLockInfo();				//清空锁控制层
	if ("true" == mediaErrorFlag) hiddenMediaError();	//清空错误层
	mp.leaveChannel();
	isLeaveChannelFlag = "true";
	previewInfo.style.display = "block";
	preview.style.display = "block";
	document.getElementById("showPreviewInfo").innerText = "您的预览次数已到，已无法继续观看此频道，你可以选择其他频道继续观看，或按&lt;返回&gt;键退出！";
	preDivIsShow = true;
}

function previewTime()//预览时间
{
	if ("true" == isNotSubFlag)  clearDiv();    //清空层
	if ("true" == lockFlag)   hiddenLockInfo();    //清空锁控制层
	if ("true" == mediaErrorFlag) hiddenMediaError();    //清空错误层
	mp.leaveChannel();
	isLeaveChannelFlag = "true";
	previewInfo.style.display = "block";
	preview.style.display = "block";
	document.getElementById("showPreviewInfo").innerText = "预览时间到，你可以选择其他频道继续观看，或按&lt;返回&gt;键退出！";
	preDivIsShow = true;
}

function hiddenPreview()//隐藏预览提示信息
{
	document.getElementById("preview").style.display = "none";
	document.getElementById("previewInfo").style.display = "none";
	preDivIsShow = false;
}
///////////////////////////////////////////////////////////////预览处理 结束


///////////////////////////////////////////////////////////////

function setcFocus()//设置焦点
{
	if (curr_pos == "chan")
	{
		document.getElementById("chan0").focus();
		return 0;
	}
}

//var clearouttime = 3000;
//var vodId = "-1";
var curr_pos = "chan";
var progIndex = 0;
var backFlag = "false";

function FocusRem(index, typepos, url)
{
	var tmpStr = new String();
	tmpStr = "prog," + progIndex;
	document.getElementById("backID").innerHTML = '<img src="images/channellist/icon-dot.gif" width="144" height="42" />';
	var temp = url.split('?');
	window.location.href = saveUrl + "?currFoucs=" + tmpStr + "&url=" + url;
}

function init_cpage()//初始化焦点
{
	curr_pos = "chan";
	backFlag = "false";
	if (backFlag == "true" && curr_pos == "prog")
		{
		curr_pos = "prog";
		RightSubPage.window.document.getElementById("type" + progIndex).focus();
		RightSubPage.window.document.getElementById("type" + progIndex).focus();
		return 0;
		}
	setFocus();
}
///////////////////////////////////////////////////////////////

</script>
<body leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" bgcolor="transparent" onLoad="javascript:init();" onUnload="destoryMP();">

<!--数据封装-->
<div id="filmInfoDB">
    <iframe name="filmInfo" id="filmInfo" src="" scroll="no" height="0px" width="0px"></iframe>
</div>

<!--直播节目信息-->
<div id="filmInfo1" style="position:absolute; left:0px; top:300px; width:640px; height:218px; z-index:1; display:none;">
    <iframe name="miniInfo" id="miniInfo" src="" scroll="no" height="218px" width="640px"></iframe>
</div>


<!--频道列表背景图-->
<div id="bg_chan" style="position:absolute; left:20; top:20; width:200; height:400; display:none">
    <img src="images/channellist/bg-ChannelList.gif" border="0" width="200" height="400"/>
</div>

<!--频道列表背景表格-->
<div id="chan_table" style="position:absolute; left:30; top:60 ;width:190; height:400; display:none"></div>

<!--频道列表中频道号显示-->
<div id="chan_num" style="position:absolute; left:40; top:60;width:40; height:400; display:none"></div>

<!--频道列表中频道名称显示-->
<div id="chan_name" style="position:absolute; left:80; top:60;width:180; height:400; display:none"></div>

<!--频道列表中页码显示-->
<div id="chan_page" style="position:absolute; left:70; top:393; width:100; height:10">
	<table border="0"><tr><td id="chang_pageShow" width="100" align="right"></td></tr></table>
</div>

<!-- 右上角频道号显示-->
<div id="topframe" style="position:absolute;left:375px; top:8px; width:200px; height:30px; z-index:1"></div>
<div id="topframe_bottomLine" style="position:absolute;left:375px; top:10px; width:200px; height:30px; z-index:2"></div>

<!--一键切换跳转层显示-->
<div id="oneKeySwitchBack" style="position:absolute; left:10px; top:200px; width:620px; height:100px; display:none;" align="center">
	<img src="images/channellist/jumpDivBack.gif" width="620px" height="100px"/>
</div>
<div id="oneKeySwitchJumpInfo" style="position:absolute; left:10px; top:210px; width:620px; height:300px; display:none; z-index:2">
	<table align="center" border="0"><tr><td id="jumpInfo" align="center"></td></tr><tr><td height="10"></td></tr>
	<tr><td>
	<table align="center"><tr><td><img id="atLeftFocus" src="images/channellist/sure-2.gif"/></td><td><img id="atRightFocus" src="images/channellist/cancel.gif"/></td></tr></table>
	</td></tr>
	</table>
</div>

<!--解决一键跳转层显示时，解锁层焦点问题-->
<a id="none" href="#"><img src="#" width="1" height="1"></a>


<!--解锁信息验证-->
<div id="">
	<iframe name="golock" id="golock" src="" scroll="no" height="0px" width="0px"></iframe>
</div>

<!--频道未定购显示-->
<div id="bg_noorder" style="position:absolute; right:0;top:60px; width:350px; height:135px; display:none">
	<img src="images/channellist/noOrder.jpg" border="0" width="350px" height="135px"/>
</div>
<div id="no_order" style="position:absolute; right:0;top:60px; width:350px; height:135px; display:none">
	<table width="350px" height="135px" border="0">
		<tr><td height="40"></td></tr>
		<tr><td id="orderInfo" width="350px" align="center"></td></tr>
		<tr><td id="showmessage" width="350px" align="center"></td></tr>
		<tr><td height="40"></td></tr>
	</table>
</div>

<!--频道未解锁显示-->
<div id="bg_lockpass" style="position:absolute;left:355px; top:60px; width:300px; height:135px; z-index:-1; display:none">
	<img src="images/channellist/nopass.jpg" border="0" width="300px" height="135px"/>
</div>
<div id="lock_pass" style="position:absolute;left:355px; top:60px; width:300px; height:135px; z-index:2; display:none">
	<form action="javascript:clickAction(true)">
		<table width="300px" height="135px" border="0">
			<tr><td width="300px" height="35"></td></tr>
			<tr><td id="passInfo" width="300px" height="30" align="center"></td></tr>
			<tr><td width="355" height="35" align="center"><input maxlength="12" type="password" height="20px" width="180px" name="pwd" id="pwd"></td></tr>
			<tr><td width="300px" height="50" align="center"></td></tr>
		</table>
	</form>
</div>

<!--预览层显示-->
<div id="preview" style="position:absolute;left:250px; top:60px; width:350px; height:135px; z-index:-1; display:none;">
	<img src="images/channellist/noOrder.jpg" border="0" width="350px" height="135px"/>
</div>
<div id="previewInfo" style="position:absolute;left:250px; top:60px; width:350px; height:135px; z-index:-1; display:none;">
	<table width="350" height="135px" border="0"><tr><td id="showPreviewInfo" width="350" align="center"></td></tr></table>
</div>

<!--错误显示-->
<div id="errorBackGround" style="position:absolute; left:150px; top:100px; width:350px; height:80px; z-index:-1; display:none">
	<img src="images/channellist/bg-seek.gif" border="0" width="350px" height="80">
</div>
<div id="errorDiv" style="position:absolute; left:120px; top:315px; width:400px; height:70px; z-index:1;display:none">
	<img src="images/channellist/jumpDivBack.gif" width="400px" height="70px"/>
</div>
<div id="errorDiv" style="position:absolute; left:120px; top:315px; width:400px; height:80px; z-index:1;display:none">
	<table width="400px" height="80" border="0"><tr><td width="400px" align="center">系统错误，请切换频道或稍候再试！</td></tr></table>
</div>

<!--
/*****上报直播信息*****/
<div id="webchanneldiv1" style="display:none;">
	<iframe name="onPrFrame" id="onPrFrame" src="" scroll="no" height="60px" width="363px" bgcolor="transparent"></iframe>
	<iframe name="prFrame" id="prFrame" src="" scroll="no" height="60px" width="363px" bgcolor="transparent"></iframe>
	<iframe name="onPrFrame2" id="onPrFrame2" src="" scroll="no" height="60px" width="363px" bgcolor="transparent"></iframe>
</div>
-->

</body>
<script language="javascript" type="text/javascript">
///////////////////////////////////////////////////////////////
init_page();
///////////////////////////////////////////////////////////////
</script>
</html>
